---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "rafay_pipeline Resource - terraform-provider-rafay"
subcategory: ""
description: |-
  
---

# rafay_pipeline (Resource)

Associates a pipeline with a project.

## Example Usage
Example of a pipeline with approval & workload deployment stage,

```terraform
resource "rafay_pipeline" "email-test" {
  metadata {
    name    = "email-test"
    project = "terraform"
  }
  spec {
    active = true
    stages {
      name = "email"
      type = "Approval"
      next {
          name = "deploy-wk"
      }
      config {
        approvers {
          sso_user  = false
          user_name = "username@email.com"
        }
        timeout = "2m0s"
        type    = "Email"
      }
    }
    stages {
      name = "deploy-wk"
      type = "DeployWorkload"
      config {
        use_revision_from_webhook_trigger_event = false
        workload                                = "workload-name"
      }
    }
    triggers {
      type =  "Cron"
      name = "trigger-name"
      config {
        cron_expression = "0 0 * * *"
        repo {
          provider = "Gitlab"
          repository = "test1"
          revision =  "main"
          paths {
              name = "project"
          }
        }
      }
    }
  }
}
```
---

Example of a pipeline with system-sync stage
```terraform
resource "rafay_pipeline" "sync-test" {
  metadata {
    name = "sync-test"
    project = "terraform"
  }
  spec {
    stages {
      name =  "system-sync"
      type = "SystemSync"
      config  {
        git_to_system_sync = true
        included_resources {
          name =  "Workload"
        }
        included_resources {
          name =  "Namespace"
        }
        included_resources {
          name =  "Pipeline"
        }
        excluded_resources {
          name =  "Cluster"
        }
        source_repo {
          repository = "test1"
          revision =  "main"
          path {
             name = "project"
          }
        }
        system_to_git_sync    = true
        source_as_destination = true
      }
    }
    triggers {
      type =  "Webhook"
      name = "trigger-name"
      config {
        repo {
          provider = "AzureRepos"
          repository = "test1"
          revision =  "main"
          paths {
              name = "project"
          }
        }
      }
    }
    sharing  {
      enabled = true
      projects {
        name = "defaultproject"
      }
    }
    active = true
  }
}
```

---
Example of pipeline with worklaod template.
```terraform
resource "rafay_pipeline" "workload-test" {
  metadata {
    name = "workload-test"
    project = "terraform"
  }
  spec {
    active = true
    stages {
      name = "deploy-workload-template"
      type = "DeployWorkloadTemplate"
      config {
        workload_template =  "workload_template_name"
        namespace =  "main"
        placement {
          labels {
            key = "rafay.dev/clusterName"
            value = "CLUSTER_NAME"
          }
        }
        use_revision_from_webhook_trigger_event = false
        overrides {
          type = "HelmValues"
          template {
            repository = "test1"
            revision = "main"
            paths {
                name = "project1/overrides_values.yaml"
            }
          }
          weight = 10
        }
        overrides {
          type = "HelmValues"
          template {
              inline = "debug: {{ .currentStage.var1 }}"
          }
          weight = 20
        }
        overrides {
          type = "HelmSetString"
          template {
              inline = "debug=override_values"
          }
          weight = 30
        }
      }
      variables {
          name = "var1"
          type = "String"
          value = "\"test\""
      }
    }
    triggers {
      type =  "Webhook"
      name = "trigger-name"
      config {
        repo {
          provider = "Github"
          repository = "test1"
          revision =  "main"
          paths {
              name = "project"
          }
        }
      }
    }
  }
}
```

---
Example of a pipeline with InfraProvisioner/Terraform stage.
```terraform
resource "rafay_pipeline" "infaprovisioner-test" {
  metadata {
    name = "infraprovisioner-test"
    project = "cbre-stage-tf-0000"
  }
  spec {
    active = true
    stages {
      name = "plan"
      type = "InfraProvisioner"
      next {
        name = "apply"
      }
      config {
        type        =  "Terraform"
        provisioner =  "mks"
        revision    =  "main"
        agents {
            name = "a1"
        }
        persist_working_directory = true
        action {
          action  = "Plan"
          version = "1.0.0"
          refresh = true
          env_vars {
            key   = "env1"
            type  = "Plain"
            value = "value1"
          }
        }
      }
    }
    stages {
      name = "apply"
      type = "InfraProvisioner"
      config {
        type        =  "Terraform"
        provisioner =  "mks"
        revision    =  "main"
        agents {
            name = "a1"
        }
        working_directory = "plan"
        action {
          action = "Apply"
          version = "1.0.0"
          refresh = true
        }
      }
    }
    
  }
}

```

<!-- schema generated by tfplugindocs -->
## Argument Reference

---
***Required***

- `metadata` (Block List, Max: 1) Contains data that helps uniquely identify the resource. (See [below for nested schema](#nestedblock--metadata)).
- `spec` (Block List, Max: 1) Defines the characteristics for the resource. This is the desired state for the resource. (See [below for nested schema](#nestedblock--spec)).

***Optional***

- `impersonate` (String) Impersonate a user.
- `timeouts` (Block) Sets the duration of time the create, delete, and update functions are allowed to run. If the function takes longer than this, it is assumed the function has failed. The default is 10 minutes. (See [below for nested schema](#nestedblock--timeouts)).


<a id="nestedblock--metadata"></a>
### Nested Schema for `metadata`


***Required***

- `name` - (String) The name of the resource. This must be unique in your organization.
- `project` - (String) The name of the Rafay project the pipeline will be associated with.

***Optional***

- `annotations` - (Map of String) Annotations of the resource.
- `description` - (String) Description of the resource.
- `labels` - (Map of String) Labels of the resource.

- `name` - (String) The name of the resource. This must be unique in your organization.
- `project` - (String) The name of the Rafay project the pipeline will be associated with.

<a id="nestedblock--spec"></a>
### Nested Schema for `spec`

***Required***
- `stages` (Block List) The stages in the pipeline. (See [below for nested schema](#nestedblock--spec--stages)).

***Optional***

- `active` (Boolean) Enables the pipeline.
- `sharing` (Block List, Max: 1) Pipeline sharing configuration. (See [below for nested schema](#nestedblock--spec--sharing)).
- `triggers` (Block List) The triggers for the pipeline. (See [below for nested schema](#nestedblock--spec--triggers)).
- `variables` (Block List) The pipeline scoped variables. (See [below for nested schema](#nestedblock--spec--variables)).


<a id="nestedblock--spec--stages"></a>
### Nested Schema for `spec.stages`

***Optional***

- `config` (Block List, Max: 1) The stage configuration. (See [below for nested schema](#nestedblock--spec--stages--config)).
- `name` (String) The name of the pipeline stage.
- `next` (Block List) The list of stages to be executed after this stage. (See [below for nested schema](#nestedblock--spec--stages--next)).
(#nestedblock--spec--stages--pre_conditions)).
- `type` (String) The type of pipeline stage. Supported values are `Approval`, `DeployWorkload`, `DeployWorkloadTemplate`, `InfraProvisioner` and `SystemSync`
- `variables` (Block List) The variables for the stage. (See [below for nested schema](#nestedblock--spec--stages--variables)).


<a id="nestedblock--spec--stages--config"></a>
### Nested Schema for `spec.stages.config`

***Optional***

- `action` (Block List, Max: 1) The list of actions for the resource. (See [below for nested schema](#nestedblock--spec--stages--config--action)).
- `agents` (Block List) The list of agents to be used for provisioning. (See [below for nested schema](#nestedblock--spec--stages--config--agents)).
- `approvers` (Block List) The list of approvers. (See [below for nested schema](#nestedblock--spec--stages--config--approvers)).
- `destination_repo` (Block List, Max: 1) The Git repository for syncing the system to Git. (See [below for nested schema](#nestedblock--spec--stages--config--destination_repo)).
- `excluded_resources` (Block List) The resources to exclude from syncing. (See [below for nested schema](#nestedblock--spec--stages--config--excluded_resources)).
- `git_to_system_sync` (Boolean) Enables synchronizing from the Git repository to the system.
- `included_resources` (Block List) The resources to include for syncing. (See [below for nested schema](#nestedblock--spec--stages--config--included_resources)).
- `namespace` (String) The namespace the workload template should be deployed in.
- `overrides` (Block List) The overrides for the workload template. (See [below for nested schema](#nestedblock--spec--stages--config--overrides)).
- `persist_working_directory` (Boolean) Enables persisting the working directory.
- `placement` (Block List, Max: 1) The placement for the workload template. (See [below for nested schema](#nestedblock--spec--stages--config--placement)).
- `provisioner` (String) The name of the infrastructure provisioner.
- `revision` (String) The branch or tag for the Git repository used for the infrastructure provisioner.
- `source_as_destination` (Boolean) Enables using the source repository as the destination repository.
- `source_repo` (Block List, Max: 1) The Git repository for syncing from Git to the system. (See [below for nested schema](#nestedblock--spec--stages--config--source_repo)).
- `system_to_git_sync` (Boolean) Enables synchronizing from the system to the Git repository.
- `timeout` (String) The timeout for the approval.
- `type` (String) The config type for supporred ations. Supported values are `Email` and `Terraform`
- `use_revision_from_webhook_trigger_event` (Boolean) Enables deploying the workload using the revision received from the webhook trigger.
- `working_directory` (String) The working directory for the provisioner.
- `workload` (String) The name of the workload.
- `workload_template` (String) The name of the workload template.


<a id="nestedblock--spec--stages--config--action"></a>
### Nested Schema for `spec.stages.config.action`

***Optional***

- `action` (String) The Terraform action. Supported values are `Plan`, `Apply` and  `Destroy`
- `backend_file_path` (Block List, Max: 1) The backend file path. (See [below for nested schema](#nestedblock--spec--stages--config--action--backend_file_path)).
- `backend_vars` (Block List) The backend variables. (See [below for nested schema](#nestedblock--spec--stages--config--action--backend_vars)).
- `destroy` (Boolean) Enables destroying the resource.
- `env_vars` (Block List) The list of environment variables. (See [below for nested schema](#nestedblock--spec--stages--config--action--env_vars)).
- `input_vars` (Block List) The input variables for Terraform. (See [below for nested schema](#nestedblock--spec--stages--config--action--input_vars)).
- `refresh` (Boolean) Enables refreshing the resource.
- `secret_groups` (List of String) The list of pipeline secrets groups.
- `targets` (Block List) The Terraform targets. (See [below for nested schema](#nestedblock--spec--stages--config--action--targets)).
- `tf_vars_file_path` (Block List, Max: 1) The path to the Terraform variable file. (See [below for nested schema](#nestedblock--spec--stages--config--action--tf_vars_file_path)).
- `version` (String) The Terraform version.


<a id="nestedblock--spec--stages--config--action--backend_file_path"></a>
### Nested Schema for `spec.stages.config.action.backend_file_path`

***Optional***

- `name` (String) The relative path of the artifact.


<a id="nestedblock--spec--stages--config--action--backend_vars"></a>
### Nested Schema for `spec.stages.config.action.backend_vars`

***Optional***

- `key` (String) The variable key.
- `type` (String) The variable type.
- `value` (String) The variable value.


<a id="nestedblock--spec--stages--config--action--env_vars"></a>
### Nested Schema for `spec.stages.config.action.env_vars`

***Optional***

- `key` (String) The variable key.
- `type` (String) The variable type.
- `value` (String) The variable value.


<a id="nestedblock--spec--stages--config--action--input_vars"></a>
### Nested Schema for `spec.stages.config.action.input_vars`

***Optional***

- `key` (String) The variable key.
- `type` (String) The variable type.
- `value` (String) The variable value.


<a id="nestedblock--spec--stages--config--action--targets"></a>
### Nested Schema for `spec.stages.config.action.targets`

***Optional***

- `name` (String) The name of the Terraform target.


<a id="nestedblock--spec--stages--config--action--tf_vars_file_path"></a>
### Nested Schema for `spec.stages.config.action.tf_vars_file_path`

***Optional***

- `name` (String) The relative path of the artifact.


<a id="nestedblock--spec--stages--config--agents"></a>
### Nested Schema for `spec.stages.config.agents`

***Optional***

- `name` (String) The name of the agent.


<a id="nestedblock--spec--stages--config--approvers"></a>
### Nested Schema for `spec.stages.config.approvers`

***Optional***

- `sso_user` (Boolean) Enables specifying if the user is an SSO user.
- `user_name` (String) The user name of the approver.


<a id="nestedblock--spec--stages--config--destination_repo"></a>
### Nested Schema for `spec.stages.config.destination_repo`

***Optional***

- `path` (Block List, Max: 1) The relative folder path in the Git repo. (See [below for nested schema](#nestedblock--spec--stages--config--destination--path)).
- `repository` (String) The name of the Git repository.
- `revision` (String) The branch or tag in the Git repository.


<a id="nestedblock--spec--stages--config--destination--path"></a>
### Nested Schema for `spec.stages.config.destination.path`

***Optional***

- `name` (String) The relative path of the artifact.


<a id="nestedblock--spec--stages--config--excluded_resources"></a>
### Nested Schema for `spec.stages.config.excluded_resources`

***Optional***

- `name` (String) The name of the system sync resource. Supported values are `Blueprint`,`Workload`,`WorkloadTemplate`,`Override`,`Addon`,`Catalog`,`Namespace`,`Pipeline`,`InfraProvisioner`,`Agent`,`Repository`,`SecretSealer`,`SecretStore`,`OPAProfile`,`OPAConstraint`,`OPAConstraintTemplate`,`OPAPolicy`,`SecretProviderClass`,`NetworkPolicyProfile`,`ClusterNetworkPolicy`,`NamespaceNetworkPolicy`,`ClusterNetworkPolicyRule`,`NamespaceNetworkPolicyRule`,`MeshProfile`,`ClusterMeshPolicy`,`NamespaceMeshPolicy`,`ClusterMeshRule`,`NamespaceMeshRule` and `Cluster`.
  

<a id="nestedblock--spec--stages--config--included_resources"></a>
### Nested Schema for `spec.stages.config.included_resources`

***Optional***

- `name` (String) The name of the system sync resource. Supported values are `Blueprint`,`Workload`,`WorkloadTemplate`,`Override`,`Addon`,`Catalog`,`Namespace`,`Pipeline`,`InfraProvisioner`,`Agent`,`Repository`,`SecretSealer`,`SecretStore`,`OPAProfile`,`OPAConstraint`,`OPAConstraintTemplate`,`OPAPolicy`,`SecretProviderClass`,`NetworkPolicyProfile`,`ClusterNetworkPolicy`,`NamespaceNetworkPolicy`,`ClusterNetworkPolicyRule`,`NamespaceNetworkPolicyRule`,`MeshProfile`,`ClusterMeshPolicy`,`NamespaceMeshPolicy`,`ClusterMeshRule`,`NamespaceMeshRule`,`Cluster` and  `*`. Defaults to `*`

Note: Same resource name can not be used for `included_resources` and `excluded_resources` in the same gitops pipeline.


<a id="nestedblock--spec--stages--config--overrides"></a>
### Nested Schema for `spec.stages.config.overrides`

***Optional***

- `template` (Block List, Max: 1) The name of the override template. (See [below for nested schema](#nestedblock--spec--stages--config--overrides--template)).
- `type` (String) The type of override template. Supportred values are `HelmValues` and  `HelmSetString`
- `weight` (Number) The weight of the override. Overrides are applied low to high weight.


<a id="nestedblock--spec--stages--config--overrides--template"></a>
### Nested Schema for `spec.stages.config.overrides.template`

***Optional***

- `inline` (String) The inline override template.
- `paths` (Block List) The paths in the repository containing the override template. (See [below for nested schema](#nestedblock--spec--stages--config--overrides--template--paths)).
- `repository` (String) The Git repository containing the override template.
- `revision` (String) The branch or tag in the repository.


<a id="nestedblock--spec--stages--config--overrides--template--paths"></a>
### Nested Schema for `spec.stages.config.overrides.template.paths`

***Optional***

- `name` (String) The relative path of the artifact.


<a id="nestedblock--spec--stages--config--placement"></a>
### Nested Schema for `spec.stages.config.placement`

***Optional***

- `labels` (Block List) The list of labels for the placement. (See [below for nested schema](#nestedblock--spec--stages--config--placement--labels)).


<a id="nestedblock--spec--stages--config--placement--labels"></a>
### Nested Schema for `spec.stages.config.placement.labels`

***Optional***

- `key` (String) The key of the placement label.
- `value` (String) The value of the placement label.


<a id="nestedblock--spec--stages--config--source_repo"></a>
### Nested Schema for `spec.stages.config.source_repo`

***Optional***

- `path` (Block List, Max: 1) The relative folder path in the Git repo. (See [below for nested schema](#nestedblock--spec--stages--config--source_repo--path)).
- `repository` (String) The name of the Git repository.
- `revision` (String) The branch or tag in the Git repository.


<a id="nestedblock--spec--stages--config--source_repo--path"></a>
### Nested Schema for `spec.stages.config.source_repo.path`

***Optional***

- `name` (String) The relative path of the artifact.


<a id="nestedblock--spec--stages--next"></a>
### Nested Schema for `spec.stages.next`

***Optional***

- `name` (String) The name of the next stage.

<a id="nestedblock--spec--stages--variables"></a>
### Nested Schema for `spec.stages.variables`

***Optional***

- `name` (String) The name of the variable.
- `type` (String) The type of the variable.
- `value` (String) The value of the variable.

<a id="nestedblock--spec--sharing"></a>
### Nested Schema for `spec.sharing`

***Optional***

- `enabled` (Boolean) Enables sharing for the resource.
- `projects` (Block List) List of projects this resource is shared with. (See [below for nested schema](#nestedblock--spec--sharing--projects)).


<a id="nestedblock--spec--sharing--projects"></a>
### Nested Schema for `spec.sharing.projects`

***Optional***

- `name` (String) The name of the project.


<a id="nestedblock--spec--triggers"></a>
### Nested Schema for `spec.triggers`

***Optional***

- `config` (Block List, Max: 1) The configuration for the trigger. (See [below for nested schema](#nestedblock--spec--triggers--config)).
- `name` (String) The name of the trigger.
- `type` (String) The trigger type. Supported values are `Webhook` and `Cron`
- `variables` (Block List) The trigger scoped variables. (See [below for nested schema](#nestedblock--spec--triggers--variables)).


<a id="nestedblock--spec--triggers--config"></a>
### Nested Schema for `spec.triggers.config`

***Optional***

- `cron_expression` (String) The cron expression for trigger.
- `repo` (Block List, Max: 1) The repo for the trigger. (See [below for nested schema](#nestedblock--spec--triggers--config--repo)).


<a id="nestedblock--spec--triggers--config--repo"></a>
### Nested Schema for `spec.triggers.config.repo`

***Optional***

- `chart_name` (String) The name of the chart in repo.
- `chart_version` (String) The version of the chart in repo.
- `paths` (Block List) The paths in the Git repo to watch for changes. (See [below for nested schema](#nestedblock--spec--triggers--config--repo--paths)).
- `provider` (String) The provider for the Git repo. Supported values are `Github`, `Gitlab`, `Bitbucket` and `AzureRepos`
- `repository` (String) The name of the Helm repository.
- `revision` (String) The branch or tag in the Git repository to watch for changes.


<a id="nestedblock--spec--triggers--config--repo--paths"></a>
### Nested Schema for `spec.triggers.config.repo.paths`

***Optional***

- `name` (String) The relative path of the artifact.


<a id="nestedblock--spec--triggers--variables"></a>
### Nested Schema for `spec.triggers.variables`

***Optional***

- `name` (String) The name of the variable.
- `type` (String) The type of the variable.
- `value` (String) The value of the variable.


<a id="nestedblock--spec--variables"></a>
### Nested Schema for `spec.variables`

***Optional***

- `name` (String) The name of the variable.
- `type` (String) The type of the variable.
- `value` (String) The value of the variable.


<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

***Optional***

- `create` - (String) Sets the timeout duration for creating a resource. The default timeout is 10 minutes.
- `delete` - (String) Sets the timeout duration for deleting a resource. The default timeout is 10 minutes.
- `update` - (String) Sets the timeout duration for updating a resource. The default timeout is 10 minutes.


## Attribute Reference

---

- `id` - (String) The ID of the resource, generated by the system after you create the resource.
- `status` - (Block List) This containts `webhook_url` and `webhook_secret` for the configured trigges in the pipeline. This can be configured in the repo for webhook.