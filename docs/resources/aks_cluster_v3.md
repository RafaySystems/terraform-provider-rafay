---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "rafay_aks_cluster_v3 Resource - terraform-provider-rafay"
subcategory: ""
description: |-
---

# rafay_aks_cluster_v3 (Resource)

This example is for the AKS Cluster v3.

## Example Usage

```terraform
resource "rafay_aks_cluster_v3" "demo-terraform" {
  metadata {
    name    = "aks-v3-tf-1"
    project = "terraform"
  }
  spec {
    type          = "aks"
    blueprint_config {
      name = "default-aks"
      version = "1.25.0"
    }
    cloud_credentials = "aks-cred"
    system_components_placement {
      node_selector = {
        app = "infra"
        dedicated = "true"
      }
      tolerations {
        effect = "PreferNoSchedule"
        key = "app"
        operator = "Equal"
        value =  "infra"
      }
      daemon_set_override {
        node_selection_enabled = false
        tolerations {
          key = "app1dedicated"
          value = true
          effect = "NoSchedule"
          operator = "Equal"
        }
      }
    }
    config {
      kind       = "aksClusterConfig"
      metadata {
        name = "aks-v3-tf-1"
      }
      spec {
        resource_group_name = "rafay-resource"
        managed_cluster {
          api_version = "2024-01-01"
          sku {
            name = "Basic"
            tier = "Free"
          }
          identity {
            type = "SystemAssigned"
          }
          location = "centralindia"
          tags = {
            "email" = "user@company.com"
            "env" = "terraform"
          }
          properties {
            api_server_access_profile {
              enable_private_cluster = true
            }
            dns_prefix         = "aks-v3-tf-2401202303-dns"
            kubernetes_version = "1.25.6"
            network_profile {
              network_plugin      = "kubenet"
              load_balancer_sku   = "standard"
            }
            power_state {
              code = "Running"
            }
            addon_profiles {
              http_application_routing {
                enabled = true
              }
              azure_policy {
                enabled = true
              }
              azure_keyvault_secrets_provider {
                enabled = true
                config {
                  enable_secret_rotation = false
                  rotation_poll_interval = "2m"
                }
              }
            }
            auto_upgrade_profile {
              upgrade_channel = "rapid"
              node_os_upgrade_channel = "NodeImage"
            }
          }
          type = "Microsoft.ContainerService/managedClusters"
        }
        node_pools {
          api_version = "2024-01-01"
          name       = "primary"
          location = "centralindia"
          properties {
            count                = 1
            enable_auto_scaling  = true
            max_count            = 2
            max_pods             = 40
            min_count            = 1
            mode                 = "System"
            orchestrator_version = "1.25.6"
            os_type              = "Linux"
            type                 = "VirtualMachineScaleSets"
            vm_size              = "Standard_DS2_v2"
            node_labels = {
              app = "infra"
              dedicated = "true"
            }
            node_taints               = ["app=infra:PreferNoSchedule"]
          }
          type = "Microsoft.ContainerService/managedClusters/agentPools"
        }

        node_pools {
          api_version = "2024-01-01"
          name       = "agentpool2"
          location = "centralindia"
          properties {
            count                = 1
            enable_auto_scaling  = true
            max_count            = 2
            max_pods             = 40
            min_count            = 1
            mode                 = "User"
            orchestrator_version = "1.25.6"
            os_type              = "Linux"
            type                 = "VirtualMachineScaleSets"
            vm_size              = "Standard_B4ms"
            node_labels = {
              app = "infra"
              dedicated = "true"
            }
            node_taints               = ["app=infra:PreferNoSchedule"]
          }
          type = "Microsoft.ContainerService/managedClusters/agentPools"
        }
        maintenance_configurations {
          api_version = "2024-01-01"
          name = "aksManagedNodeOSUpgradeSchedule"
          properties {
            maintenance_window {
              duration_hours = 4
              schedule {
                daily {
                  interval_days = 1
                }
              }
              start_date = "2024-07-19"
              start_time = "11:38"
              utc_offset = "+05:30"
            }
          }
          type = "Microsoft.ContainerService/managedClusters/maintenanceConfigurations"
        }

      }
    }
  }
}
```

<!-- schema generated by tfplugindocs -->

## Argument Reference

### Required

- `metadata` - (Block List, Max: 1) Contains data that helps uniquely identify the resource. (See [below for nested schema](#nestedblock--metadata))
- `spec` - (Block List, Max: 1) Defines the characteristics for the resource. This is the desired state for the resource. (See [below for nested schema](#nestedblock--spec))

### Optional

- `timeouts` - (Block) Sets the duration of time the create, delete, and update functions are allowed to run. If the function takes longer than this, it is assumed the function has failed. The default is 10 minutes. (See [below for nested schema](#nestedblock--timeouts))

<a id="nestedblock--metadata"></a>

### Nested Schema for `metadata`

**_Required_**

- `name` - (String) The name of the AKS Cluster. This must be unique in your organization.
- `project` - (String) The name of the Rafay project the cluster will be created in.

**_Optional_**

- `labels` - (Map of String) The labels for the cluster.

<a id="nestedblock--spec"></a>

### Nested Schema for `spec`

**_Required_**

- `cloud_credentials` - (String) The name of the cloud credentials used to create and manage the cluster.
- `config` - (Block List, Min: 1) The AKS specific cluster configuration. (See [below for nested schema](#nestedblock--spec--config))
- `sharing` - (Block List, Max: 1) The sharing configuration for the Cluster. Cluster can be shared with one or more projects. (See [below for nested schema](#nestedblock--spec--sharing))
- `type` - (String) The AKS Cluster type. The supported value is `aks`.
- `system_components_placement` - (Block, list, Max: 1) Configure tolerations and nodeSelector for Rafay system components. (See [below for nested schema](#nestedblock--spec--system_components_placement))

**_Optional_**

- `blueprint_config` - (String) The blueprint name and version used with the cluster. (See [below for nested schema](#nestedblock--spec--blueprint_config)).

<a id="nestedblock--spec--system_components_placement"></a>

### Nested Schema for `spec.system_components_placement`

**_Required_**

- `node_selector` - (Map of String) Key-Value pairs insuring pods to be scheduled on desired nodes. Explore further in the [Kubernetes Documentation](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)
- `tolerations` - (Block list, Min: 0) Enables the kuberenetes scheduler to schedule pods with matching taints. Explore further in the [Kubernetes Documentation](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/) (See [below for nested schema](#nestedblock--spec--system_components_placement--tolerations))
- `daemonset_override` - (Block list, Min: 0) Allows users to override the default behaviour of DaemonSet for specific nodes, enabling the addition of additional tolerations for Daemonsets to match the taints available on the nodes. (See [below for nested schema](#nestedblock--spec--system_components_placement--daemonset_override))

<a id="nestedblock--spec--system_components_placement--tolerations"></a>

### Nested Schema for `spec.system_components_placement.tolerations`

**_Required_**

- `key` - (String) The taint key that the toleration applies to.
- `effect` - (String) Indicates the taint effect to match.
- `operator`- (String) Represents a key's relationship to the value.

**_Optional_**

- `value` - (String) The taint value the toleration matches to.
- `toleration_seconds` - (Number) Represents the period of time the toleration tolerates the taint

<a id="nestedblock--spec--system_components_placement--daemonset_override"></a>

### Nested Schema for `spec.system_components_placement.daemonset_override`

**_Required_**

- `node_selection_enabled` - (Bool) Enables node selection.
- `tolerations` - (Block list, Min: 0) Additional tolerations for Daemonsets to match the taints available on the nodes. (See [below for nested schema](#nestedblock--spec--system_components_placement--tolerations))

<a id="nestedblock--spec--config"></a>

### Nested Schema for `spec.config`

**_Required_**

- `kind` - (String) The AKS cluster configuration. The supported value is `aksClusterConfig`.
- `metadata` - (Block List, Min: 1) AKS specific cluster configuration metadata. (See [below for nested schema](#nestedblock--spec--config--metadata))
- `spec` - (Block List, Min: 1) AKS specific cluster configuration spec. (See [below for nested schema](#nestedblock--spec--config--spec))

<a id="nestedblock--spec--config--metadata"></a>

### Nested Schema for `spec.config.metadata`

**_Required_**

- `name` - (String) The name of the AKS cluster.

<a id="nestedblock--spec--config--spec"></a>

### Nested Schema for `spec.config.spec`

**_Required_**

- `managed_cluster` - (Block List) The AKS managed cluster. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster))
- `node_pools` - (Block List, Min: 1) The AKS node pool. (See [below for nested schema](#nestedblock--spec--config--spec--node_pools))
- `maintenance_configurations` - (Block List, Min: 0) The AKS Maintenance Configurations used to configure Auto-Upgrade Profile Schedule. (See [below for nested schema]
(#nestedblock--spec--cluster_config--spec--maintenance_configurations)) 
- `resource_group_name` - (String) The AKS resource group for the cluster.

<a id="nestedblock--spec--config--spec--managed_cluster"></a>

### Nested Schema for `spec.config.spec.managed_cluster`

**_Required_**

- `apiversion` - (String) The Azure resource managed cluster API version. The supported value is `2024-01-01`.
- `location` - (String) The AKS cluster location.
- `properties` - (Block List, Min: 1) The properties of the managed cluster. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties))
- `type` - (String) The supported value is `Microsoft.ContainerService/managedClusters`.

**_Optional_**

- `additional_metadata` - (Block List) Additional metadata associated with the managed cluster. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--additional_metadata))
- `identity` - (Block List) The AKS managed cluster extended location. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--identity))
- `sku` - (Block List) The SKU of a Managed Cluster. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--sku))
- `tags` - (Map of String) Resource tags.

<a id="nestedblock--spec--config--spec--managed_cluster--properties"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties`

**_Required_**

- `kubernetes_version` - (String) Kubernetes version

**_Optional_**

- `aad_profile` (Block List) Configurations for Azure active directory profile. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--aad_profiles))
- `addons_profile` (Block List) Configurations for AKS managed addons. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles))
- `api_server_access_profile` - (Block List) The AKS managed cluster API server access profile. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--api_server_access_profile))
- `auto_scaler_profile` - (Block List) The configurations for Cluter autoscaler profile. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--auto_scaler_profile))
- `disk_encryption_set_id` - (String) The ID of the Disk Encryption Set which should be used for the Nodes and Volumes. This is of the form: `/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Compute/diskEncryptionSets/{encryptionSetName}`
- `dns_prefix` - (String) DNS prefix specified when creating the managed cluster. This cannot be updated once the Managed Cluster has been created.
- `enable_rbac` - (boolean) Enable Kubernetes Role-Based Access Control.
- `disable_local_accounts` - (boolean) If set to true, getting static credentials will be disabled for this cluster. This must only be used on Managed Clusters that are AAD enabled.
- `identity_profile` - (Block List) Identities associated with the cluster. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--managed_cluster--properties--identity_profile))
- `linux_profile` - (Block List) The configurations for linux profile. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--linux_profile))
- `network_profile` - (Block List) Profile of the network configuration. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--network_profile))
- `node_resource_group` - (String) The name of the resource group containing agent pool nodes.
- `pod_identity_profile` - (Block List) Azure Active Directory (Azure AD) pod-managed identities use Kubernetes primitives to associate managed identities for Azure resources and identities in Azure AD with pods. See [Use Azure AD Pod-Managed Identities](https://learn.microsoft.com/en-us/azure/aks/use-azure-ad-pod-identity) for more information. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--pod_identity_profile))
- `power_state` - (Block List) Cluster Power State to Stop/Start the AKS cluster. See [Stop and start an Azure Kubernetes Service (AKS) cluster](https://learn.microsoft.com/en-us/azure/aks/start-stop-cluster?tabs=azure-cli) for more information.
- `service_principal_profile` - (Block List) Information about a service principal identity for the cluster to use for manipulating Azure APIs. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--service_principal_profile))
- `auto_upgrade_profile` - (Block List) Configure Auto-Upgrade Profile to handle automatic k8s version upgrade and node os image upgrade. See [below for nested schema]
(#nestedblock--spec--cluster_config--spec--managed_cluster--properties--auto_upgrade_profile)

<a id="nestedblock--spec--cluster_config--spec--managed_cluster--properties--auto_upgrade_profile"></a>

### Nested Schema for `spec.cluster_config.spec.managed_cluster.properties.auto_upgrade_profile`

**_Required_**
- `upgrade_channel` - (String) Configure channel with one of the following values [none, rapid, stable, patch, node-image]
- `node_os_upgrade_channel` - (String) Configure channel with one of the following values [None, NodeImage, SecurityPatch]

<a id="nestedblock--spec--cluster_config--spec--managed_cluster--properties--identity_profile"></a>

### Nested Schema for `spec.cluster_config.spec.managed_cluster.properties.identity_profile`

**_Optional_**

- `kubelet_identity` - (Block List) Its is a user-assigned managed identity used by the kubelet to access Azure resources. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--managed_cluster--properties--identity_profile--kubelet_identity))

<a id="nestedblock--spec--cluster_config--spec--managed_cluster--properties--identity_profile--kubelet_identity"></a>

### Nested Schema for `spec.cluster_config.spec.managed_cluster.properties.identity_profile.kubelet_identity`

**_Required_**

- `resource_id` (String) - ARM resource IDs in the form: `/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.ManagedIdentity/userAssignedIdentities/{identityName}`.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--aad_profiles"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.aad_profiles`

**_Optional_**

- `admin_group_object_ids` (List of String) - The AKS managed cluster aad profile admin group object ids.
- `enable_azure_rbac` (Boolean) - Enable/Disable azure rbac for kubernetes authorization.
- `managed` (Boolean) - Enable/Disable managed Azure Active Directory integration.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.addon_profiles`

**_Optional_**

- `azure_keyvault_secrets_provider` (Block List) Configurations for Azure keyvault secrets provider. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--azure_keyvault_secrets_provider))
- `azure_policy` (Block List) Configurations for azure policy. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--azure_policy))
- `http_application_routing` - (Block List) Configurations for HTTP application routing. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--http_application_routing))
- `ingress_application_gateway` - (Block List) Configurations for Azure Ingress Application Gateway. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--ingress_application_gateway))
- `oms_agent` - (Block List) (See [below for nested schema] Configurations for OMS agent. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--oms_agent))

<a id="nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--azure_keyvault_secrets_provider"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.addon_profiles.azure_keyvault_secrets_provider`

**_Required_**

- `enabled` - (Boolean) - Enable/Disable Azure keyVault secret provider.
- `config` - (Block List) Configurations for Azure keyvault secrets provider. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--azure_keyvault_secrets_provider--config))

<a id="nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--azure_keyvault_secrets_provider--config"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.addon_profiles.azure_keyvault_secrets_provider.config`

**_Required_**

- `enable_secret_rotation` (String) Enable/Disable secret rotation.
- `rotation_poll_interval` (String) The interval to poll for secret rotation. Defaults to `2m`.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--azure_policy"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.addon_profiles.azure_policy`

**_Required_**

- `enabled` - (Boolean) - Enable/Disable Azure Policy.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--http_application_routing"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.addon_profiles.http_application_routing`

**_Required_**

- `enabled` - (Boolean) - Enable/Disable HTTP Application Routing.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--ingress_application_gateway"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.addon_profiles.ingress_application_gateway`

**_Required_**

- `enabled` - (Boolean) - Enable/Disable Azure Ingress Application Gateway.
- `config` - (Block List) Configurations for Azure Ingress Application Gateway. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--ingress_application_gateway--config)

<a id="nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--ingress_application_gateway--config"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.addon_profiles.ingress_application_gateway.config`

**_Optional_**

- `application_gateway_name` - (String) - Name of the application gateway to create/use in the node resource group.
- `application_gateway_id` - (String) - Resource Id of an existing Application Gateway to use with AGIC.
- `subnet_cidr` - (String) - Subnet CIDR to use for a new subnet created to deploy the Application Gateway.
- `subnet_id` - (String) - Resource Id of an existing Subnet used to deploy the Application Gateway.
- `watch_namespace` - (String)- Specify the namespace, which AGIC should watch. This could be a single string value, or a comma-separated list of namespaces.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--oms_agent"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.addon_profiles.oms_agent`

**_Required_**

- `enabled` - (Boolean) - Enable/Disable OMS Agent.
- `config` - (Block List) Configurations for OMS agent. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--oms_agent--config))

<a id="nestedblock--spec--config--spec--managed_cluster--properties--addon_profiles--oms_agent--config"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.addon_profiles.oms_agent.config`

**_Required_**

- `log_analytics_workspace_resource_id` - (String) Log analytics workspace reource. This is of the form: `"/subscriptions/{subscriptionId}/resourcegroups/{resourceGroupName}/providers/microsoft.operationalinsights/workspaces/{logAnalyticsWorkspace}"`

<a id="nestedblock--spec--config--spec--managed_cluster--properties--api_server_access_profile"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.api_server_access_profile`

**_Optional_**

- `authorized_ip_ranges` - (List of String) The AKS managed cluster properties server access profile server access profile.
- `enable_private_cluster` - (Boolean) Enable an AKS private cluster.
- `enable_private_cluster_public_fqdn` - (Boolean) Enable pubic FQDN for an AKS private cluster.
- `private_dns_zone` - (String) It requires you to create a Private DNS Zone in this format for Azure global cloud: privatelink.<region>.azmk8s.io or <subzone>.privatelink.<region>.azmk8s.io. You will need to specify the Resource ID of that Private DNS Zone. Additionally, you will need a user assigned identity or service principal with at least the private dns zone contributor and network contributor roles.

  **Note**: The value of `private_dns_zone` needs to be set to `null` or empty when the `enable_private_cluster` is set to `false`.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--auto_scaler_profile"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.auto_scaler_profile`

**_Optional_**

- `balance_similar_node_groups` - (String) Balance number of nodes for similar node groups. Defaults to `"false"`
- `expander` - (String) Expander to use. Supported values are `least-waste`, `most-pods`, `priority` and `random`. Defaults to `random`
- `max_graceful_termination_sec` - (String) Maximum graceful termination time in seconds. Defaults to `600`.
- `max_node_provision_time` - (String) Maximum wait time for node to be provisioned. Defaults to `15m`.
- `ok_total_unready_count` - (String) Number of allowed unready nodes. Defaults to `"3"`.
- `max_total_unready_percentage` - (String) Number of percentage of unready nodes. Defaults to `"45"`.
- `new_pod_scale_up_delay` - (String) For scenarios like burst/batch scale where you don't want CA to act before the kubernetes scheduler could schedule all the pods, you can tell CA to ignore unscheduled pods before they're a certain age. Defaults to `10s`.
- `scale_down_delay_after_add` - (String) How long after the scale up of AKS nodes the scale down evaluation resumes. Defaults to `10m`.
- `scale_down_delay_after_delete` - (String) How long after node deletion that scale down evaluation resumes. Defaults to the value used for scan_interval (`10s`).
- `scale_down_delay_after_failure` - (String) How long after scale down failure that scale down evaluation resumes. Defaults to `3m`.
- `scan_interval` - (String) How often the AKS Cluster should be re-evaluated for scale up/down. Defaults to `10s`.
- `scale_down_unneeded_time` - (String) How long a node should be unneeded before it is eligible for scale down. Defaults to `10m`.
- `scale_down_unready_time` - (String) How long an unready node should be unneeded before it is eligible for scale down. Defaults to `20m`.
- `scale_down_utilization_threshold` - (String) The scale down utilization threshold. Defaults to `"0.5"`
- `max_empty_bulk_delete` - (String) Number of empty nodes that can be deleted at the same time. Defaults to `"10"`.
- `skip_nodes_with_local_storage` - (String) Skip autoscaler to delete nodes with pods with local storage. Defaults to `"false"`.
- `skip_nodes_with_system_pods` - (String) Skip autoscaler to delete nodes with system pods. Defaults to `"false"`.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--linux_profile"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.linux_profile`

**_Optional_**

- `admin_username` - (String) The administrator username to use for Linux VMs.
- `ssh` - (Block List) SSH configuration for Linux-based VMs running on Azure. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--linux_profile--ssh))

<a id="nestedblock--spec--config--spec--managed_cluster--properties--linux_profile--ssh"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.linux_profile.ssh`

**_Required_**

- `public_key` - (Block List) The list of SSH public keys used to authenticate with Linux-based VMs. A maximum of 1 key may be specified. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--linux_profile--ssh--public_key))

<a id="nestedblock--spec--config--spec--managed_cluster--properties--linux_profile--ssh--public_key"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.linux_profile.ssh.public_key`

**_Required_**

- `key_data` (String) The public key used to authenticate with VMs through SSH.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--network_profile"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.network_profile`

**_Optional_**

- `dns_service_ip` - (String) An IP address assigned to the Kubernetes DNS service.
- `docker_bridge_cidr` - (String) A CIDR notation IP range assigned to the Docker bridge network.
- `load_balancer_sku` - (String) Supported values are: `standard` and `basic`.
- `network_mode` - (String) This cannot be specified if `networkPlugin` is anything other than `azure`. The supported values are `transparent` and `bridge`.
- `network_plugin` - (String) The network plugin used for building the Kubernetes network. Supported values are: `azure` and `kubenet`.
- `network_plugin_mode` - (String) The network plugin mode used for building the Kubernetes network. Supported values are: `overlay`.
- `network_policy` - (String) The network policy used for building the Kubernetes network. Supported values are: `calico` and `azure`.
- `outbound_type` - (String) The outbound/egress routing method.
  Supported values are: `loadBalancer` and `userDefinedRouting`.
- `pod_cidr` - (String) A CIDR notation IP range from which to assign pod IPs when kubenet is used.
- `service_cidr` - (String) A CIDR notation IP range from which to assign service cluster IPs.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--pod_identity_profile"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.pod_identity_profile`

**_Required_**

- allow_network_plugin_kubenet - (Boolean) Enables running in Kubenet. **Note**: Running in Kubenet is disabled by default due to the security related nature of AAD Pod Identity and the risks of IP spoofing. See [Using Kubenet network plugin with AAD Pod Identity](https://learn.microsoft.com/en-us/azure/aks/use-azure-ad-pod-identity#using-kubenet-network-plugin-with-azure-active-directory-pod-managed-identities) for more information.
- enabled - (Boolean) Enables the pod identity add-on.
- user_assigned_identities - (Block List) The pod identities used in the cluster. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--pod_identity_profile--user_assigned_identities))

**_Optional_**

- user_assigned_identity_exceptions - (Block List) The pod identity exceptions to allow. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--pod_identity_profile--user_assigned_identity_exceptions))

<a id="nestedblock--spec--config--spec--managed_cluster--properties--pod_identity_profile--user_assigned_identities"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.pod_identity_profile.user_assigned_identities`

**_Required_**

- identity - (Block List) Details about the user assigned identity. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--properties--pod_identity_profile--user_assigned_identities--identity))
- name - (String) The name of the pod identity.
- namespace - (String) The namespace of the pod identity.

**_Optional_**

- binding_selector - (String) The binding selector to use for the AzureIdentityBinding resource.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--pod_identity_profile--user_assigned_identities--identity"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.pod_identity_profile.user_assigned_identities.identity`

**_Required_**

- client_id - (String) The client ID for the user assigned identity.
- object_id - (String) The object ID for the user assigned identity.
- resource_id - (String) The resource ID for the user assigned identity.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--pod_identity_profile--user_assigned_identity_exceptions"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.pod_identity_profile.user_assigned_identity_exceptions`

**_Required_**

- name - (String) The name of the pod identity exception.
- namespace - (String) The namespace of the pod identity exception.
- pod_labels - (String) The pod labels to match.

<a id="nestedblock--spec--config--spec--managed_cluster--properties--service_principal_profile"></a>

### Nested Schema for `spec.config.spec.managed_cluster.properties.service_principal_profile`

**_Required_**

- `client_id` - (String) The ID for the service principal. If specified, must be set to `[parameters('servicePrincipalClientId')]`. This would be set to the cloud credential's client ID during cluster deployment.
- `secret` - (String) The secret password associated with the service principal in plain text.

<a id="nestedblock--spec--config--spec--managed_cluster--additional_metadata"></a>

### Nested Schema for `spec.config.spec.managed_cluster.additional_metadata`

**_Optional_**

- `acr_profile` - (Block List) The profile for the Azure Container Registry configuration. (See [below for nested schema](#nestedblock--spec--config--spec--managed_cluster--additional_metadata--acr_profile))
- `oms_workspace_location` - (String) The location of the Log analytics workspace.

<a id="nestedblock--spec--config--spec--managed_cluster--additional_metadata--acr_profile"></a>

### Nested Schema for `spec.config.spec.managed_cluster.additional_metadata.acr_profile`

**_Optional_**

- `registries` - (Block List) Registry for the Azure Container Registry configuration. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--managed_cluster--additional_metadata--acr_profile--registries))

<a id="nestedblock--spec--cluster_config--spec--managed_cluster--additional_metadata--acr_profile--registries"></a>

### Nested Schema for `spec.cluster_config.spec.managed_cluster.additional_metadata.acr_profile--registries`

**_Required_**

- `acr_name` - (String) The name of the Azure Container Registry resource.

**_Optional_**

- `resource_group_name` - (String) If not specified, defaults to the resource group of the managed cluster.

<a id="nestedblock--spec--config--spec--managed_cluster--identity"></a>

### Nested Schema for `spec.config.spec.managed_cluster.identity`

**_Required_**

- `type` - (String) The identity type for the AKS cluster. For more information see [Use managed identities in AKS](https://docs.microsoft.com/en-us/azure/aks/use-managed-identity). Supported values are: `SystemAssigned`, `UserAssigned`, and `None`.
- `user_assigned_identities` - (Map of String) User assigned Managed identity. The keys must be ARM resource IDs in the form: `/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.ManagedIdentity/userAssignedIdentities/{identityName}`. Values has to be an empty object. `"{}"`

<a id="nestedblock--spec--config--spec--managed_cluster--sku"></a>

### Nested Schema for `spec.config.spec.managed_cluster.sku`

**_Required_**

- `name` - (String) The name of a managed cluster SKU. The supported value is `Basic`.
- `tier` - (String) Supported values are: `Paid` and `Free`.

<a id="nestedblock--spec--config--spec--node_pools"></a>

### Nested Schema for `spec.config.spec.node_pools`

**_Required_**

- `apiversion` - (String) The AKS node pool API version. The supported value is `2024-01-01`.
- `location` - (String) The AKS node pool location.
- `name` - (String) The AKS node pool name.
- `properties` - (Block List, Min: 1) The AKS managed cluster properties. (See [below for nested schema](#nestedblock--spec--config--spec--node_pools--properties))
- `type` - (String) The AKS node pool type. The supported value is `Microsoft.ContainerService/managedClusters/agentPools`.

<a id="nestedblock--spec--config--spec--node_pools--properties"></a>

### Nested Schema for `spec.config.spec.node_pools.properties`

**_Optional_**

- `availability_zones` - (List of String) The list of availability zones to use for nodes. This can only be specified if the `AgentPoolType` property is `VirtualMachineScaleSets`.
- `count` - (Number) The number of agents (VMs) to host docker containers. Allowed values must be in the range of `0` to `1000` (inclusive) for user pools and in the range of `1` to `1000` (inclusive) for system pools. The default value is `1`.
- `enable_auto_scaling` - (Boolean) Enables the auto-scaler.
- `enable_node_public_ip` - (Boolean) Assigns public IPs directly to nodes, allowing external access.
- `enable_encryption_at_host` - (Boolean) Encrypts data on nodes for added security.
- `max_count` - (Number) The maximum number of nodes for auto-scaling.
- `max_pods` - (Number) The maximum number of pods that can run on a node.
- `min_count` - (Number) The minimum number of nodes for auto-scaling
- `mode` - (String) The mode for a node pool which defines a node pool's primary function. If set as `System`, AKS prefers system pods scheduling to node pools with mode `System`. Supported values are: `System` and `User`.
- `node_labels` - (Map of String) Node labels.
- `node_taints` - (List of String) The taints added to new nodes during node pool create and scale. For example, key=value:NoSchedule.
- `orchestrator_version` - (String) The AKS node pool Kubernetes version.
- `os_disk_size_gb` - (Number) OS Disk Size in GB to be used to specify the disk size for every machine in the master/agent pool.
- `os_disk_type` - (String) Supported values are: `Managed` and `Ephemeral`.
- `os_type` - (String) Supported values are: `Linux` and `Windows`.
- `pod_subnet_id` - (String) If omitted, pod IPs are statically assigned on the node subnet (See vnet_subnet_id for more details). This is of the form: `/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/virtualNetworks/{virtualNetworkName}/subnets/{subnetName}`.
- `scale_set_eviction_policy` - (String) This cannot be specified unless the `scaleSetPriority` is `Spot`. If not specified, the default is `Delete`. Supported values are: `Delete` and `Deallocate`.
- `scale_set_priority` - (String) The virtual machine scale set priority. If not specified, the default is `Regular`. Supported values are: `Spot` and `Regular`.
- `spot_max_price` - (Number) Supported values are: any decimal value greater than zero or -1 (which indicates the willingness to pay any on-demand price). For more details on spot pricing, see [Azure Spot Virtual Machines](https://azure.microsoft.com/en-us/services/virtual-machines/spot/).
- `tags` - (Map of String) Resource tags.
- `type` - (String) Supported values are `VirtualMachineScaleSets` and `AvailabilitySet`.
- `upgrade_settings` - (Block List) Settings for upgrading an agentpool. (See [below for nested schema](#nestedblock--spec--config--spec--node_pools--properties--upgrade_settings))
- `vm_size` - (String) The AKS node pool VM size.
- `vnet_subnet_id` - (String) If this is not specified, a VNET and subnet will be generated and used. If no `podSubnetID` is specified, this applies to nodes and pods, otherwise it applies to just nodes.

<a id="nestedblock--spec--config--spec--node_pools--properties--upgrade_settings"></a>

### Nested Schema for `spec.config.spec.node_pools.properties.upgrade_settings`

**_Optional_**

- `max_surge` - (String) This can either be set to an integer (e.g. 5) or a percentage (e.g. 50%). See [Customize node surge upgrade](https://docs.microsoft.com/en-us/azure/aks/upgrade-cluster#customize-node-surge-upgrade) for more details.

<a id="nestedblock--spec--cluster_config--spec--maintenance_configurations"></a>

### Nested Schema for `spec.cluster_config.spec.maintenance_configurations`

**_Required_**
- `api_version` - (String) The AKS maintenance configuration API version. The recommended value is `2024-01-01`.
- `name` - (String) The AKS maintenance configuration name. It should be one of the following values [default, aksManagedNodeOSUpgradeSchedule, aksManagedAutoUpgradeSchedule].
- `type` - (String) The AKS maintenance configuration type. The supported value is `Microsoft.ContainerService/managedClusters/maintenanceConfigurations`.
- `properties` - (Block List, Min: 1) The AKS maintenance configuration properties. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--maintenance_configurations--properties))

<a id="nestedblock--spec--cluster_config--spec--maintenance_configurations--properties"></a>

### Nested Schema for `spec.cluster_config.spec.maintenance_configurations.properties`

**_Required_**
- `maintenance_window` - (Block List, Min: 1) Configure maintenance window in a maintenance configuration. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window))

**_Optional_**
- `not_allowed_time` - (Block List) Configure start and end time for maintenance configuration to not run. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--not_allowed_time))
- `time_in_week` - (Block List) Configure day and hour_slots for maintenance configuration to run. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--time_in_week))

<a id="nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--not_allowed_time"></a>

### Nested Schema for `spec.cluster_config.spec.maintenance_configurations.properties.not_allowed_time`

**_Optional_**
- `end` - (String) The end of a time span.
- `start` - (String) The start of a time span.

<a id="nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--time_in_week"></a>

### Nested Schema for `spec.cluster_config.spec.maintenance_configurations.properties.time_in_week`

**_Optional_**
- `day` - (String) Specify day of the week. Value should be one of the following [Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday]
- `hourSlot` - (Block List) Each integer hour represents a time range beginning at 0m after the hour ending at the next hour (non-inclusive). 0 corresponds to 00:00 UTC, 23 corresponds to 23:00 UTC. Specifying [0, 1] means the 00:00 - 02:00 UTC time range. Value should be between 0 to 23 

<a id="nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window"></a>

### Nested Schema for `spec.cluster_config.spec.maintenance_configurations.properties.maintenance_window`

**_Required_**
- `duration_hours` - (Number) Configure the value between 4 to 24 hours.
- `start_time` - (String) Configure the start time of maintenance window. Accepted values should be in format of 'HH:MM'.
- `schedule` - (Block List) Recurrence schedule for the maintenance window. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--schedule))

**_Optional_**
- `not_allowed_dates` - (Block List) Date ranges on which upgrade is not allowed. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--not_allowed_dates))
- `start_date` - (String) The date the maintenance window activates. If the current date is before this date, the maintenance window is inactive and will not be used for upgrades. If not specified, the maintenance window will be active right away.
- `utc_offset` - (String) The UTC offset in format +/-HH:mm. If not specified, the default is '+00:00'.

<a id="nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--schedule"></a>

### Nested Schema for `spec.cluster_config.spec.maintenance_configurations.properties.maintenance_window.schedule`

**_Optional_**
- `absolute_monthly` - (Block List) For schedules like: 'recur every month on the 10th' or 'recur every 4 months on the 15th'. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--schedule--absolute_monthly))
- `relative_monthly` - (Block List) For schedules like: 'recur every month on the first Wednesday' or 'recur every 4 months on last Friday'. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--schedule--relative_monthly))
- `daily` - (Block List) For schedules like: 'recur every 2 days'. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--schedule--daily))
- `weekly` - (Block List) For schedules like: 'recur every Monday' or 'recur every 3 weeks on Monday'. (See [below for nested schema](#nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--schedule--weekly))

<a id="nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--schedule--absolute_monthly"></a>

### Nested Schema for `spec.cluster_config.spec.maintenance_configurations.properties.maintenance_window.schedule.absolute_monthly`

**_Required_**
- `day_of_month` - (Number) The date of the Month. Value should be between 1 to 31.
- `interval_months` - (Number) Specifies the number of months between each set of occurrences. Value should be between 1 to 6.

<a id="nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--schedule--relative_monthly"></a>

### Nested Schema for `spec.cluster_config.spec.maintenance_configurations.properties.maintenance_window.schedule.relative_monthly`

**_Required_**
- `day_of_week` - (String) The day of the week. Value should be one of the following [Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday]
- `interval_months` - (Number) Specifies the number of months between each set of occurrences. Value should be between 1 to 6.
- `week_index` - (String) Specifies on which week of the month the dayOfWeek applies. Value should be one of the following [First, Second, Third, Fourth, Last]

<a id="nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--schedule--daily"></a>

### Nested Schema for `spec.cluster_config.spec.maintenance_configurations.properties.maintenance_window.schedule.daily`

**_Required_**
- `intervalDays` - (Number) Specifies the number of days between each set of occurrences. Value should be between 1 to 7.

<a id="nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--schedule--weekly"></a>

### Nested Schema for `spec.cluster_config.spec.maintenance_configurations.properties.maintenance_window.schedule.weekly`

**_Required_**
- `day_of_week` - (Number) Specifies on which day of the week the maintenance occurs. Value should be one of the following [Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday]
- `interval_weeks` - (Number) Specifies the number of weeks between each set of occurrences. Value should be between 1 to 4.

<a id="nestedblock--spec--cluster_config--spec--maintenance_configurations--properties--maintenance_window--not_allowed_dates"></a>

### Nested Schema for `spec.cluster_config.spec.maintenance_configurations.properties.maintenance_window.not_allowed_dates`

**_Required_**
- `end` - (String) End date for the date span.
- `start` - (String) Start date for the date span.

<a id="nestedblock--spec--sharing"></a>

### Nested Schema for `spec.sharing`

**_Required_**

- `enabled` - (Boolean) Enable sharing for this resource.
- `projects` - (Block List) The list of projects this resource is shared with. (See [below for nested schema](#nestedblock--spec--sharing--projects))

<a id="nestedblock--spec--sharing--projects"></a>

### Nested Schema for `spec.sharing.projects`

**_Required_**

- `name` - (String) The name of the project to share the resource.

<a id="nestedblock--spec--blueprint_config"></a>

### Nested Schema for `spec.blueprint_config`

**_Required_**

- `name` - (String) The name of the blueprint.
- `version` - (String) The version of the blueprint.

<a id="nestedblock--timeouts"></a>

### Nested Schema for `timeouts`

**_Optional_**

- `create` - (String) Sets the timeout duration for creating a resource. The default timeout is 10 minutes.
- `delete` - (String) Sets the timeout duration for deleting a resource. The default timeout is 10 minutes.
- `update` - (String) Sets the timeout duration for updating a resource. The default timeout is 10 minutes.

## Attribute Reference

---

- `id` - (String) The ID of the resource, generated by the system after you create the resource.

# rafay_aks_cluster_v3 (data source)

## Example Usage

---

```terraform
data "rafay_aks_cluster_v3" "cluster" {
  metadata {
    name    = "cluster-name"
    project = "demo"
  }
}

output "aks_cluster_v3" {
  description = "aks_cluster_v3"
  value       = data.rafay_aks_cluster_v3.cluster
}
```

---

# rafay_aks_cluster_v3 (Azure CNI Overlay)

## Example Usage

---

```terraform
resource "rafay_aks_cluster" "demo-terraform" {
  apiversion = "rafay.io/v1alpha1"
  kind       = "Cluster"
  metadata {
    name    = "demo-terraform"
    project = "terraform"
  }
  spec {
    type          = "aks"
    blueprint     = "default-aks"
    cloudprovider = "testuser-azure"
    cluster_config {
      apiversion = "rafay.io/v1alpha1"
      kind       = "aksClusterConfig"
      metadata {
        name = "demo-terraform"
      }
      spec {
        resource_group_name = "testuser-terraform"
        managed_cluster {
          apiversion = "2023-11-01"
          identity {
            type = "SystemAssigned"
          }
          location = "centralindia"
          properties {
            api_server_access_profile {
              enable_private_cluster = true
            }
            dns_prefix         = "testuser-test-dns"
            kubernetes_version = "1.28.5"
            network_profile {
              network_plugin      = "azure"
              load_balancer_sku   = "standard"
              network_plugin_mode = "overlay"
              pod_cidr            = "192.168.0.0/16"
              service_cidr        = "10.0.0.0/16"
              dns_service_ip      = "10.0.0.10"
            }
            power_state {
              code = "Running"
            }
          }
          type = "Microsoft.ContainerService/managedClusters"
        }
        node_pools {
          apiversion = "2023-11-01"
          name       = "primary"
		      location   = "centralindia"
          properties {
            count                = 2
            enable_auto_scaling  = true
            max_count            = 2
            max_pods             = 40
            min_count            = 1
            mode                 = "System"
            orchestrator_version = "1.28.5"
            os_type              = "Linux"
            type                 = "VirtualMachineScaleSets"
            vm_size              = "Standard_DS2_v2"
            node_labels = {
              app = "infra"
              dedicated = "true"
            }
            node_taints          = ["app=infra:PreferNoSchedule"]
          }
          type = "Microsoft.ContainerService/managedClusters/agentPools"
        }
      }
    }
    system_components_placement {
      node_selector = {
        app = "infra"
        dedicated = "true"
      }
      tolerations {
        effect = "PreferNoSchedule"
        key = "app"
        operator = "Equal"
        value =  "infra"
      }

      daemonset_override {
        node_selection_enabled = false
        tolerations {
          key = "app1dedicated"
          value = true
          effect = "NoSchedule"
          operator = "Equal"
        }
      }
    }
  }
}
```

---
