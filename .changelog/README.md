# Changelog Fragments

This directory contains individual changelog fragments for each merged pull request. These fragments are automatically generated by the changelog automation system and later compiled into the main `CHANGELOG.md` during releases.

## Workflow

### 1. PR Merge Process

When a PR is merged, the automated changelog system:

1. **Analyzes commits** in the PR
2. **Generates changelog entries** using AI (categorized by type)
3. **Writes a fragment file** to `.changelog/{PR_NUMBER}.txt`
4. **Updates** the `Unreleased` section in `CHANGELOG.md`

### 2. File Naming Convention

```
.changelog/
├── 1131.txt        # Changelog for PR #1131
├── 1132.txt        # Changelog for PR #1132
├── 1145.txt        # Changelog for PR #1145
└── README.md       # This file
```

Each file is named with the PR number: `{PR_NUMBER}.txt`

### 3. Fragment Format

Each fragment file contains categorized changelog entries:

```markdown
### FEATURES

* **New Resource:** `rafay_eks_cluster`: Support for managing EKS clusters ([#1131](https://github.com/RafaySystems/terraform-provider-rafay/pull/1131))

### ENHANCEMENTS

* resource/rafay_gke_cluster: Add label support for better resource organization ([#1131](https://github.com/RafaySystems/terraform-provider-rafay/pull/1131))

### BUG FIXES

* resource/rafay_aks_cluster: Fix NPE when node pool configuration is nil ([#1131](https://github.com/RafaySystems/terraform-provider-rafay/pull/1131))
```

## Categories

Changelog entries are categorized into:

- **BREAKING CHANGES** - Changes that break existing user configurations
- **FEATURES** - New resources, data sources, or major functionality
- **ENHANCEMENTS** - Improvements to existing functionality
- **BUG FIXES** - Corrections to incorrect behavior
- **DEPRECATIONS** - Advance notice of future breaking changes
- **DOCUMENTATION** - Significant documentation updates

## Manual Generation

To manually generate a changelog for a PR:

```bash
# Dry run (preview only)
python3 scripts/generate-changelog.py \
  --pr-number 1131 \
  --pr-url https://github.com/RafaySystems/terraform-provider-rafay/pull/1131 \
  --base-ref origin/master \
  --head-ref HEAD \
  --dry-run

# Actually generate and write files
python3 scripts/generate-changelog.py \
  --pr-number 1131 \
  --pr-url https://github.com/RafaySystems/terraform-provider-rafay/pull/1131 \
  --base-ref origin/master \
  --head-ref HEAD
```

This will:
1. Create/update `.changelog/1131.txt`
2. Update the `Unreleased` section in `CHANGELOG.md`

## Release Process

During a release, fragments are compiled into the versioned section of `CHANGELOG.md`:

1. All fragments in `.changelog/` are reviewed
2. Entries are consolidated into a version section (e.g., `## 1.2.0 (Nov 15, 2025)`)
3. The `Unreleased` section is cleared

## Notes

- Fragment files should be committed to git
- Each PR should have its own fragment file
- Fragments are used for audit trail and release compilation
- AI-generated content may need manual review before release

