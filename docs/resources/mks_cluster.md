---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "rafay_mks_cluster Resource - rafay"
subcategory: ""
description: |-
  
---

# rafay_mks_cluster (Resource)

## Example usage

### MKS Single Node Converged Cluster
```terraform
resource "rafay_mks_cluster" "mks-noha-converged-cluster" {
  api_version = "infra.k8smgmt.io/v3"
  kind        = "Cluster"
  metadata = {
    name    = "mks-noha-converged-cluster"
    project = "terraform"
  }
  spec = {
    blueprint = {
      name = "minimal"
    }
    config = {
      auto_approve_nodes      = true
      kubernetes_version      = "v1.28.9"
      network = {
        cni = {
          name    = "Calico"
          version = "3.26.1"
        }
        pod_subnet     = "10.244.0.0/16"
        service_subnet = "10.96.0.0/12"
      }
      nodes = {
        "hostname1" = {
          arch             = "amd64"
          hostname         = "hostname1"
          operating_system = "Ubuntu22.04"
          private_ip       = "10.12.25.234"
          roles            = ["ControlPlane", "Worker"]
          ssh = {
            username   = "ubuntu"
            port= "22"
            ip_address = "10.12.25.234"
            private_key_path = "/path/to/privatekey/"
          }
        }
      }
    }
    type = "mks"
  }
}
```


### MKS HA Cluster with Dedicated Control Plane

```terraform
resource "rafay_mks_cluster" "mks-ha-cluster-with-dedicated-cp" {
  api_version = "infra.k8smgmt.io/v3"
  kind        = "Cluster"
  metadata = {
    name    = "mks-ha-cluster-with-dedicated-cp"
    project = "terraform"
  }
  spec = {
    blueprint = {
      name = "minimal"
    }
    cloud_credentials = "mks-ssh-credentials"
    config = {
      auto_approve_nodes      = true
      high_availability       = true
      dedicated_control_plane = true
      kubernetes_version      = "v1.28.9"
      kubernetes_upgrade = {
        strategy = "sequential"
        params = {
          worker_concurrency = "50%"
        }
      }
      network = {
        cni = {
          name    = "Calico"
          version = "3.26.1"
        }
        pod_subnet     = "10.244.0.0/16"
        service_subnet = "10.96.0.0/12"
      }
      nodes = {
        "hostname1" = {
          arch             = "amd64"
          hostname         = "hostname1"
          operating_system = "Ubuntu22.04"
          private_ip       = "10.12.25.234"
          roles            = ["ControlPlane"]
          labels = {
            "app"   = "infra"
            "infra" = "true"
          }
        },
        "hostname2" = {
          arch             = "amd64"
          hostname         = "hostname2"
          operating_system = "Ubuntu22.04"
          private_ip       = "10.12.25.234"
          roles            = ["ControlPlane"]
        },
        "hostname3" = {
          arch             = "amd64"
          hostname         = "hostname3"
          operating_system = "Ubuntu22.04"
          private_ip       = "10.12.25.235"
          roles            = ["ControlPlane"]
        },
        "hostname4" = {
          arch             = "amd64"
          hostname         = "hostname4"
          operating_system = "Ubuntu22.04"
          private_ip       = "10.12.114.236"
          roles            = ["Worker"]
          labels = {
            "app"   = "infra"
            "infra" = "true"
          }
          taints = [
            {
              effect = "NoSchedule"
              key    = "infra"
              value  = "true"
            },
            {
              effect = "NoSchedule"
              key    = "app"
              value  = "infra"
            },
          ]
        }
      }
    }
    system_components_placement = {
      node_selector = {
        "app"   = "infra"
        "infra" = "true"
      }
      tolerations = [
        {
          effect   = "NoSchedule"
          key      = "infra"
          operator = "Equal"
          value    = "true"
        },
        {
          effect   = "NoSchedule"
          key      = "app"
          operator = "Equal"
          value    = "infra"
        },
        {
          effect   = "NoSchedule"
          key      = "app"
          operator = "Equal"
          value    = "platform"
        },
      ]
    }
    type = "mks"
  }
}
```


<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `metadata` (Attributes) metadata of the resource (see [below for nested schema](#nestedatt--metadata))
- `spec` (Attributes) cluster specification (see [below for nested schema](#nestedatt--spec))

### Optional

- `api_version` (String) api version
- `kind` (String) kind

<a id="nestedatt--metadata"></a>
### Nested Schema for `metadata`

Required:

- `name` (String) name of the resource
- `project` (String) Project of the resource

Optional:

- `annotations` (Map of String) annotations of the resource
- `description` (String) description of the resource
- `labels` (Map of String) labels of the resource


<a id="nestedatt--spec"></a>
### Nested Schema for `spec`

Required:

- `blueprint` (Attributes) (see [below for nested schema](#nestedatt--spec--blueprint))
- `config` (Attributes) MKS V3 cluster specification (see [below for nested schema](#nestedatt--spec--config))

Optional:

- `cloud_credentials` (String) The credentials to be used to ssh into the  Clusster Nodes
- `proxy` (Attributes) (see [below for nested schema](#nestedatt--spec--proxy))
- `sharing` (Attributes) (see [below for nested schema](#nestedatt--spec--sharing))
- `system_components_placement` (Attributes) (see [below for nested schema](#nestedatt--spec--system_components_placement))
- `type` (String) The type of the cluster this spec corresponds to

<a id="nestedatt--spec--blueprint"></a>
### Nested Schema for `spec.blueprint`

Required:

- `name` (String)

Optional:

- `version` (String) Version of the blueprint


<a id="nestedatt--spec--config"></a>
### Nested Schema for `spec.config`

Required:

- `kubernetes_version` (String) Kubernetes version of the Control Plane
- `network` (Attributes) MKS Cluster Network Specification (see [below for nested schema](#nestedatt--spec--config--network))
- `nodes` (Attributes Map) holds node configuration for the cluster (see [below for nested schema](#nestedatt--spec--config--nodes))

Optional:

- `auto_approve_nodes` (Boolean) Auto approves incoming nodes by default
- `cluster_ssh` (Attributes) SSH config for all the nodes within the cluster (see [below for nested schema](#nestedatt--spec--config--cluster_ssh))
- `dedicated_control_plane` (Boolean) Select this option for preventing scheduling of user workloads on Control Plane nodes
- `high_availability` (Boolean) Select this option for highly available control plane. Minimum three control plane nodes are required
- `kubernetes_upgrade` (Attributes) (see [below for nested schema](#nestedatt--spec--config--kubernetes_upgrade))
- `location` (String) The data center location where the cluster nodes will be launched

<a id="nestedatt--spec--config--network"></a>
### Nested Schema for `spec.config.network`

Required:

- `cni` (Attributes) MKS Cluster CNI Specification (see [below for nested schema](#nestedatt--spec--config--network--cni))
- `pod_subnet` (String) Kubernetes pod subnet
- `service_subnet` (String) Kubernetes service subnet

Optional:

- `ipv6` (Attributes) (see [below for nested schema](#nestedatt--spec--config--network--ipv6))

<a id="nestedatt--spec--config--network--cni"></a>
### Nested Schema for `spec.config.network.cni`

Required:

- `name` (String) Provide the CNI name, e.g., Calico or Cilium
- `version` (String) Provide the CNI version, e.g., 3.26.1


<a id="nestedatt--spec--config--network--ipv6"></a>
### Nested Schema for `spec.config.network.ipv6`

Optional:

- `pod_subnet` (String) Kubernetes pod subnet
- `service_subnet` (String) Kubernetes service subnet



<a id="nestedatt--spec--config--nodes"></a>
### Nested Schema for `spec.config.nodes`

Required:

- `arch` (String) System Architecture of the node
- `hostname` (String) Hostname of the node
- `operating_system` (String) OS of the node
- `private_ip` (String) Private ip address of the node
- `roles` (Set of String) Valid roles are: 'ControlPlane', 'Worker', 'Storage'

Optional:

- `interface` (String) Interface to be used on the node
- `labels` (Map of String) labels to be added to the node
- `ssh` (Attributes) MKS Node SSH definition (see [below for nested schema](#nestedatt--spec--config--nodes--ssh))
- `taints` (Attributes Set) taints to be added to the node (see [below for nested schema](#nestedatt--spec--config--nodes--taints))

<a id="nestedatt--spec--config--nodes--ssh"></a>
### Nested Schema for `spec.config.nodes.ssh`

Optional:

- `ip_address` (String) Use this to override node level ssh details
- `passphrase` (String) SSH Passphrase
- `port` (String) SSH Port
- `private_key_path` (String) Specify Path to SSH private key
- `username` (String) SSH Username


<a id="nestedatt--spec--config--nodes--taints"></a>
### Nested Schema for `spec.config.nodes.taints`

Optional:

- `effect` (String)
- `key` (String)
- `value` (String)



<a id="nestedatt--spec--config--cluster_ssh"></a>
### Nested Schema for `spec.config.cluster_ssh`

Optional:

- `passphrase` (String) Provide ssh passphrase
- `port` (String) Provide ssh port
- `private_key_path` (String) Provide local path to the private key
- `username` (String) Provide the ssh username


<a id="nestedatt--spec--config--kubernetes_upgrade"></a>
### Nested Schema for `spec.config.kubernetes_upgrade`

Required:

- `params` (Attributes) (see [below for nested schema](#nestedatt--spec--config--kubernetes_upgrade--params))
- `strategy` (String) Kubernetes upgrade strategy for worker nodes and Valid options are: concurrent/sequential

<a id="nestedatt--spec--config--kubernetes_upgrade--params"></a>
### Nested Schema for `spec.config.kubernetes_upgrade.params`

Required:

- `worker_concurrency` (String) It can be number or percentage




<a id="nestedatt--spec--proxy"></a>
### Nested Schema for `spec.proxy`

Required:

- `enabled` (Boolean)
- `http_proxy` (String)
- `https_proxy` (String)

Optional:

- `allow_insecure_bootstrap` (Boolean)
- `bootstrap_ca` (String)
- `no_proxy` (String)
- `proxy_auth` (String)


<a id="nestedatt--spec--sharing"></a>
### Nested Schema for `spec.sharing`

Required:

- `enabled` (Boolean)
- `projects` (Attributes Set) (see [below for nested schema](#nestedatt--spec--sharing--projects))

<a id="nestedatt--spec--sharing--projects"></a>
### Nested Schema for `spec.sharing.projects`

Required:

- `name` (String)



<a id="nestedatt--spec--system_components_placement"></a>
### Nested Schema for `spec.system_components_placement`

Optional:

- `daemon_set_override` (Attributes) (see [below for nested schema](#nestedatt--spec--system_components_placement--daemon_set_override))
- `node_selector` (Map of String)
- `tolerations` (Attributes Set) (see [below for nested schema](#nestedatt--spec--system_components_placement--tolerations))

<a id="nestedatt--spec--system_components_placement--daemon_set_override"></a>
### Nested Schema for `spec.system_components_placement.daemon_set_override`

Optional:

- `daemon_set_tolerations` (Attributes Set) (see [below for nested schema](#nestedatt--spec--system_components_placement--daemon_set_override--daemon_set_tolerations))
- `node_selection_enabled` (Boolean)

<a id="nestedatt--spec--system_components_placement--daemon_set_override--daemon_set_tolerations"></a>
### Nested Schema for `spec.system_components_placement.daemon_set_override.daemon_set_tolerations`

Optional:

- `effect` (String)
- `key` (String)
- `operator` (String)
- `toleration_seconds` (Number)
- `value` (String)



<a id="nestedatt--spec--system_components_placement--tolerations"></a>
### Nested Schema for `spec.system_components_placement.tolerations`

Optional:

- `effect` (String)
- `key` (String)
- `operator` (String)
- `toleration_seconds` (Number)
- `value` (String)
